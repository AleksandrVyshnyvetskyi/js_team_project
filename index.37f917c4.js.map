{"mappings":"iiBAAA,IAAAA,EAAAC,EAAA,S,gFAOMC,EAAO,CACTC,WAAYC,SAASC,cAAc,sBACnCC,QAASF,SAASC,cAAc,iBAChCE,gBAAiBH,SAASC,cAAc,8BACxCG,UAAWJ,SAASC,cAAc,sBAGhCI,EAAa,IAAI,EAAAC,EAAAC,SACjBC,EAAa,IAAI,EAAAC,EAAAF,S,SAiCRG,I,OAAAC,EAAcC,MAAAC,KAAAC,W,SAAdH,I,OAAAA,EAAfI,EAAAnB,EAAA,CAAAmB,EAAAC,GAAAC,MAAA,SAAAC,I,IAA8BC,EAEpBC,EAASC,EAAAP,U,yEAFWK,EAAAE,EAAAC,OAAA,YAAAD,EAAA,IAAYA,EAAA,GAEhCD,EAAYD,GAAc,EACJd,EAAjBkB,cAAgBH,E,kBAIYf,EAAlBmB,mBAAmBC,MAAK,SAAAC,GACvC,GAAyB,IAArBA,EAAKC,YACN,OAAO7B,EAAKM,UAAUwB,UAAUC,OAAO,aAExCrB,EAAWsB,eAAiBV,EACFZ,EAAfuB,cAAgBL,EAAKC,YACGnB,EAAxBwB,YAActB,EACKF,EAAnByB,mBACGC,IACdpC,EAAKM,UAAUwB,UAAUO,IAAI,cAE7B,EAAAC,EAAAC,kBAAiBX,EAAKY,UACtB,EAAAC,EAAAC,iCAAiCd,EAAKY,SACtCG,QAAQC,IAAIhB,EAAKC,gB,uDAGrBc,QAAQC,IAAGC,EAAAC,I,qGAvBJjC,EAAcC,MAAAC,KAAAC,WA6E7B,SAASoB,IACLpC,EAAKK,gBAAgB0C,UAAY,GAjGrC/C,EAAKC,WAAW+C,iBAAiB,UAEjC,SAAkBC,GAKd,GAHAA,EAAMC,iBACN3C,EAAW4C,WAAaF,EAAMG,cAAcC,SAASC,MAAMC,MAAMC,OAEtC,KAAvBxD,EAAKI,QAAQmD,MACZ,OAAOvD,EAAKM,UAAUwB,UAAUC,OAAO,aAI5C/B,EAAKM,UAAUwB,UAAUO,IAAI,aAE7BzB,IAEAZ,EAAKI,QAAQmD,MAAQ,M","sources":["src/js/search-by-keyword.js"],"sourcesContent":["import { renderMoviesCard } from \"./create-markup\";\nimport { hideLoader, showLoader } from './loader';\nimport { addCurrrentMoviesToLocalStorage } from \"./local-storage\";\nimport Pagination from './pagination.js';\nimport API from './api-service.js';\n\n\nconst refs = {\n    searchForm: document.querySelector('.header_input-wrap'),\n    inputEl: document.querySelector('.header_input'),\n    moviesContainer: document.querySelector('.main-container--card__box'),\n    errorText: document.querySelector('.header_error-msg'),\n};\n\nconst apiService = new API;\nconst pagination = new Pagination;\n\n///////винесено в api-service\n// let searchQuery = '';\n\n// const BASE_URL = `https://api.themoviedb.org/3/search/movie`;\n// const KEY = `2994e3a31c3cad99fd99bf3fe61d916f`;\n\n// async function fetchSearchMovie(searchQuery) {\n//     return await axios.get(`${BASE_URL}?api_key=${KEY}&language=en-US&query=${searchQuery}`)\n//         .then(response => response.data);\n// }\n///////////\n\nrefs.searchForm.addEventListener('submit', onSearch);\n\nfunction onSearch(event) {\n    \n    event.preventDefault();\n    apiService.inputQuery = event.currentTarget.elements.query.value.trim();\n\n    if (refs.inputEl.value === \"\") {\n         return refs.errorText.classList.remove('is-hidden');\n    }\n    \n    // console.log(searchQuery);\n    refs.errorText.classList.add('is-hidden');\n   \n    getSearchMovie();\n\n    refs.inputEl.value = \"\";\n}\n\nasync function getSearchMovie(page = false) {\n    \n    const queryPage = page ? page : 1; // Проверка страниц, обязательно до fetch\n    apiService.setPageNumber = queryPage; // Передает текущую страницу в класс api\n\n    // showLoader();\n    try {\n        await apiService.fetchSearchMovie().then(data => {\n          if (data.total_pages === 0) {\n             return refs.errorText.classList.remove('is-hidden');\n           };\n            pagination.setCurrentPage = queryPage; // Передает страницу в пагинатор\n            pagination.setTotalPages = data.total_pages; // Передает общее кол-во страниц в пагинатор\n            pagination.setCallback = getSearchMovie; // Передает ссылку на коллбэк функцию \n            pagination.renderPagination(); // Вызов пагинации\n            clearMoviesContainer();\n            refs.errorText.classList.add('is-hidden');\n            \n            renderMoviesCard(data.results);\n            addCurrrentMoviesToLocalStorage (data.results) \n            console.log(data.total_pages);\n        });      \n    } catch (error) {\n        console.log(error)\n    } finally {\n        // hideLoader();\n    }\n    \n}\n\n///////////// --функція перенесена в файл create-markup----///////\n// function renderMoviesCard(results) {\n//     const markup = results\n//         .map(el => {\n//             return `\n//             <li class=\"main-container--card\">\n//             <img src = \"https://image.tmdb.org/t/p/w500${el.poster_path}\"\n//             class = \"film-poster\"\n//             alt=\"${el.original_title}\" loading=\"lazy\"\n//              />\n//             <div class=\"film-info\">\n//             <h3 class=\"film-title\">${el.original_title.toUpperCase()}</h3>\n//             <p class=\"more-info\">${transformId(el.genre_ids)} | ${el.release_date.slice(0, 4)}</p>\n//             </div>\n//             </li> `\n//         })\n//         .join('');\n    \n//     refs.moviesContainer.insertAdjacentHTML('beforeend', markup);\n// };\n\n///////////// --функція перенесена в файл create-markup----///////\n// function transformId ([...arr]) {\n//     const g = localStorage.getItem(\"GENRES\");\n//     const genres = JSON.parse(g);\n//     let genreName;\n//     const array = [...arr]\n//     for (let i = 0; i < genres.length; i++) {\n//         for (let y = 0; y < array.length; y++) {\n//             if (array[y] === genres[i].id) {\n//                 genreName = genres[i].name;\n//                 array[y] = genreName\n//             };\n//         };\n//     };\n//     // console.log(array)\n//     if (array.length > 3) {\n//         return `${array[0]}, ${array[1]}, Other`\n//     } else if (array.length > 2) {\n//         return `${array[0]}, ${array[1]}, ${array[2]}`\n//     } else if (array.length > 1) {\n//         return `${array[0]}, ${array[1]}`\n//     }\n//     return `${array[0]}`\n// };\n\n\nfunction clearMoviesContainer() {\n    refs.moviesContainer.innerHTML = \"\";\n}\n\n"],"names":["$bpxeT","parcelRequire","$ffc2dcc44f21eabb$var$refs","searchForm","document","querySelector","inputEl","moviesContainer","errorText","$ffc2dcc44f21eabb$var$apiService","$1h2Gi","default","$ffc2dcc44f21eabb$var$pagination","$jcFG7","$ffc2dcc44f21eabb$var$getSearchMovie","$ffc2dcc44f21eabb$var$_getSearchMovie","apply","this","arguments","$parcel$interopDefault","$2TvXO","mark","_callee","page","queryPage","_args","length","setPageNumber","fetchSearchMovie","then","data","total_pages","classList","remove","setCurrentPage","setTotalPages","setCallback","renderPagination","$ffc2dcc44f21eabb$var$clearMoviesContainer","add","$dI30Z","renderMoviesCard","results","$4LMMA","addCurrrentMoviesToLocalStorage","console","log","_ctx","t0","innerHTML","addEventListener","event","preventDefault","inputQuery","currentTarget","elements","query","value","trim"],"version":3,"file":"index.37f917c4.js.map"}